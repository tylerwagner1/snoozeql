---
phase: 01-multi-cloud-discovery
plan: 05
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - web/src/pages/Dashboard.tsx
  - web/src/lib/api.ts
  - cmd/server/main.go
autonomous: true

must_haves:
  truths:
    - "User can click stats cards to navigate to filtered instances view"
    - "Dashboard shows accurate running and stopped instance counts"
    - "Dashboard has CTAs for adding cloud accounts"
  artifacts:
    - path: "web/src/pages/Dashboard.tsx"
      provides: "Clickable stats cards with navigation, add account CTAs"
      contains: "useNavigate"
    - path: "cmd/server/main.go"
      provides: "Stats endpoint with real instance counts"
      contains: "running_instances"
  key_links:
    - from: "web/src/pages/Dashboard.tsx"
      to: "/instances?status=running"
      via: "navigate on click"
      pattern: "navigate.*instances"
---

<objective>
Enhance Dashboard with clickable stats cards and add account CTAs.

Purpose: Dashboard is the home screen. Stats cards should be interactive - clicking "Running Databases: 3" should navigate to instances filtered by running status. Prominent CTAs guide users to add cloud accounts.

Output: Interactive dashboard with clickable stats cards navigating to pre-filtered views, and prominent add account buttons.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-multi-cloud-discovery/01-CONTEXT.md
@.planning/phases/01-multi-cloud-discovery/01-RESEARCH.md

@web/src/pages/Dashboard.tsx
@web/src/pages/InstancesPage.tsx
@cmd/server/main.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make stats cards clickable with navigation</name>
  <files>web/src/pages/Dashboard.tsx</files>
  <action>
Add navigation to stats cards:

1. Import useNavigate from react-router-dom:
   ```typescript
   import { useNavigate } from 'react-router-dom'
   ```

2. Initialize navigate:
   ```typescript
   const navigate = useNavigate()
   ```

3. Wrap stats cards with click handlers. Update the Running Databases card:
   ```tsx
   <div 
     className="bg-slate-800/50 rounded-xl p-5 shadow-lg border border-slate-700 hover:border-blue-500/50 transition-all group cursor-pointer"
     onClick={() => navigate('/instances?status=running')}
   >
     {/* existing content */}
   </div>
   ```

4. Update Sleeping Databases card:
   ```tsx
   <div 
     className="bg-slate-800/50 rounded-xl p-5 shadow-lg border border-slate-700 hover:border-purple-500/50 transition-all group cursor-pointer"
     onClick={() => navigate('/instances?status=stopped')}
   >
     {/* existing content */}
   </div>
   ```

5. Update Pending Actions card (navigate to recommendations):
   ```tsx
   <div 
     className="bg-slate-800/50 rounded-xl p-5 shadow-lg border border-slate-700 hover:border-yellow-500/50 transition-all group cursor-pointer"
     onClick={() => navigate('/recommendations')}
   >
     {/* existing content */}
   </div>
   ```

6. Total Savings card can link to a future savings/analytics page or stay non-clickable for now.

7. Update InstancesPage to read URL params for initial filter state (if not already done).
  </action>
  <verify>
Frontend compiles. Clicking stats cards navigates to /instances with query params. Cards show pointer cursor on hover.
  </verify>
  <done>
Stats cards are clickable. Running card navigates to /instances?status=running. Sleeping card navigates to /instances?status=stopped.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update InstancesPage to read URL filter params</name>
  <files>web/src/pages/InstancesPage.tsx</files>
  <action>
Make InstancesPage read initial filter state from URL:

1. Import useSearchParams:
   ```typescript
   import { useSearchParams, Link } from 'react-router-dom'
   ```

2. Read initial filter from URL:
   ```typescript
   const [searchParams, setSearchParams] = useSearchParams()
   
   const [filters, setFilters] = useState<{
     status: string
     provider: string
   }>({
     status: searchParams.get('status') || 'all',
     provider: searchParams.get('provider') || 'all'
   })
   ```

3. Update URL when filters change:
   ```typescript
   const updateFilter = (key: 'status' | 'provider', value: string) => {
     setFilters(prev => ({ ...prev, [key]: value }))
     const newParams = new URLSearchParams(searchParams)
     if (value === 'all') {
       newParams.delete(key)
     } else {
       newParams.set(key, value)
     }
     setSearchParams(newParams)
   }
   ```

4. Update filter dropdowns to use updateFilter:
   ```tsx
   <select
     value={filters.status}
     onChange={(e) => updateFilter('status', e.target.value)}
     className="..."
   >
   ```

5. Map URL status values to filter values:
   - 'running' -> filter for 'available', 'running', 'starting'
   - 'stopped' -> filter for 'stopped', 'stopping'
   - 'all' -> no filter
  </action>
  <verify>
Frontend compiles. Navigating to /instances?status=running shows only running instances. Filter dropdown syncs with URL. Changing filter updates URL.
  </verify>
  <done>
InstancesPage reads filter from URL params. Dashboard navigation results in pre-filtered view. Filter changes update URL.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add prominent CTAs for adding cloud accounts</name>
  <files>web/src/pages/Dashboard.tsx</files>
  <action>
Add CTAs for adding cloud accounts when no accounts exist or as quick actions:

1. Add cloudAccounts state and fetch:
   ```typescript
   const [cloudAccounts, setCloudAccounts] = useState<CloudAccount[]>([])
   
   useEffect(() => {
     const fetchData = async () => {
       try {
         const [instancesData, recommendationsData, accountsData] = await Promise.all([
           api.getInstances(),
           api.getRecommendations(),
           api.getCloudAccounts()
         ])
         setInstances(instancesData)
         setRecommendations(recommendationsData)
         setCloudAccounts(accountsData)
       } catch (err) {
         console.error(err)
       }
     }
     fetchData()
   }, [])
   ```

2. Add CTA section below stats cards (or if no accounts, show prominently):
   ```tsx
   {cloudAccounts.length === 0 && (
     <div className="bg-gradient-to-r from-blue-900/50 to-purple-900/50 rounded-xl p-6 border border-blue-500/30">
       <h2 className="text-xl font-semibold text-white mb-2">Get Started</h2>
       <p className="text-slate-300 mb-4">Connect your cloud accounts to discover and manage database instances.</p>
       <div className="flex gap-3">
         <button
           onClick={() => navigate('/cloud-accounts')}
           className="px-4 py-2 bg-gradient-to-r from-yellow-500 to-orange-600 text-white font-medium rounded-lg hover:from-yellow-400 hover:to-orange-500 transition-all shadow-lg"
         >
           Add AWS Account
         </button>
         <button
           onClick={() => navigate('/cloud-accounts')}
           className="px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-medium rounded-lg hover:from-blue-400 hover:to-indigo-500 transition-all shadow-lg"
         >
           Add GCP Account
         </button>
       </div>
     </div>
   )}
   ```

3. Even when accounts exist, add quick action links:
   ```tsx
   {cloudAccounts.length > 0 && (
     <div className="flex gap-4">
       <button
         onClick={() => navigate('/cloud-accounts')}
         className="text-sm text-blue-400 hover:text-blue-300 flex items-center gap-1"
       >
         <Plus className="h-4 w-4" />
         Add Account
       </button>
       <button
         onClick={() => navigate('/instances')}
         className="text-sm text-slate-400 hover:text-slate-300 flex items-center gap-1"
       >
         View All Instances â†’
       </button>
     </div>
   )}
   ```

4. Import CloudAccount type and Plus icon from lucide-react.
  </action>
  <verify>
Frontend compiles. When no accounts exist, prominent CTA section appears. Add account buttons navigate to /cloud-accounts.
  </verify>
  <done>
Prominent CTAs guide users to add cloud accounts. Quick action links appear for existing users. Empty state highlights getting started.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` in web/ compiles without errors
2. Clicking Running Databases card navigates to /instances?status=running
3. Clicking Sleeping Databases card navigates to /instances?status=stopped
4. InstancesPage shows pre-filtered results when URL has query params
5. Filter dropdown reflects URL state
6. Changing filter updates URL
7. Dashboard shows prominent CTAs when no cloud accounts
8. Add account buttons navigate to /cloud-accounts
</verification>

<success_criteria>
- Stats cards are clickable with pointer cursor
- Running card navigates to /instances?status=running
- Stopped card navigates to /instances?status=stopped
- URL params control initial filter state
- Filter changes update URL (deep linking works)
- CTAs for adding accounts appear prominently
- Navigation works correctly
</success_criteria>

<output>
After completion, create `.planning/phases/01-multi-cloud-discovery/01-05-SUMMARY.md`
</output>
