---
phase: 01-multi-cloud-discovery
plan: 04
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - web/src/pages/CloudAccountsPage.tsx
  - web/src/lib/api.ts
autonomous: true

must_haves:
  truths:
    - "User can see connection status for each cloud account"
    - "User sees skeleton loading state during initial load"
    - "User sees toast notifications on connection errors"
  artifacts:
    - path: "web/src/pages/CloudAccountsPage.tsx"
      provides: "Connection status chips, skeleton loading, toast notifications"
      contains: "connectionStatusColors"
    - path: "web/src/lib/api.ts"
      provides: "CloudAccount with connection_status field"
      contains: "connection_status"
  key_links:
    - from: "web/src/pages/CloudAccountsPage.tsx"
      to: "api.getCloudAccounts"
      via: "loadAccounts useEffect"
      pattern: "api\\.getCloudAccounts"
---

<objective>
Add connection status indicators, skeleton loading, and toast notifications to CloudAccountsPage.

Purpose: Users need visual feedback on cloud account connection health. Status chips (connected/syncing/failed) show at-a-glance health. Skeleton loading provides perceived performance during data fetch. Toast notifications surface errors without blocking UI.

Output: CloudAccountsPage with connection status chips, skeleton loading states, and error toast notifications.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-multi-cloud-discovery/01-CONTEXT.md
@.planning/phases/01-multi-cloud-discovery/01-RESEARCH.md

@web/src/pages/CloudAccountsPage.tsx
@web/src/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add connection status types and styling</name>
  <files>web/src/lib/api.ts, web/src/pages/CloudAccountsPage.tsx</files>
  <action>
1. In `api.ts`, update CloudAccount interface:
   ```typescript
   export interface CloudAccount {
     id: string
     name: string
     provider: string
     regions: string[]
     connection_status?: 'connected' | 'syncing' | 'failed' | 'unknown'
     last_sync_at?: string
     last_error?: string
     created_at: string
   }
   ```

2. In `CloudAccountsPage.tsx`, add connection status color map:
   ```typescript
   const connectionStatusColors: Record<string, string> = {
     connected: 'bg-green-500/10 text-green-400 border-green-500/30',
     syncing: 'bg-blue-500/10 text-blue-400 border-blue-500/30 animate-pulse',
     failed: 'bg-red-500/10 text-red-400 border-red-500/30',
     unknown: 'bg-slate-500/10 text-slate-400 border-slate-500/30',
   }
   ```

3. Replace the static "Connected" chip with dynamic status chip:
   ```tsx
   <div className="flex items-center gap-2 text-sm">
     <span className={`px-2 py-0.5 text-xs rounded-full border ${
       connectionStatusColors[account.connection_status || 'unknown']
     }`}>
       {account.connection_status === 'connected' && <Check className="inline h-3 w-3 mr-1" />}
       {account.connection_status === 'syncing' && <RefreshCw className="inline h-3 w-3 mr-1 animate-spin" />}
       {account.connection_status === 'failed' && <AlertCircle className="inline h-3 w-3 mr-1" />}
       {(account.connection_status || 'unknown').charAt(0).toUpperCase() + (account.connection_status || 'unknown').slice(1)}
     </span>
   </div>
   ```

4. If status is 'failed', show last_error on hover or below status:
   ```tsx
   {account.connection_status === 'failed' && account.last_error && (
     <p className="text-xs text-red-400 mt-1 truncate" title={account.last_error}>
       {account.last_error.substring(0, 50)}...
     </p>
   )}
   ```

5. Add imports for icons: `RefreshCw`, `AlertCircle` from lucide-react
  </action>
  <verify>
Frontend compiles. Cloud account cards show status chip that reflects connection_status from API.
  </verify>
  <done>
Connection status chips display with appropriate colors and icons. Failed accounts show error message.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add skeleton loading state</name>
  <files>web/src/pages/CloudAccountsPage.tsx</files>
  <action>
Add skeleton loading state for initial page load:

1. Add loading state (if not already present):
   ```typescript
   const [loading, setLoading] = useState(true)
   ```

2. Update loadAccounts to manage loading state:
   ```typescript
   const loadAccounts = async () => {
     setLoading(true)
     try {
       const accounts = await api.getCloudAccounts()
       setAccounts(accounts)
     } catch (err) {
       console.error('Failed to load accounts:', err)
       setError('Failed to load cloud accounts')
     } finally {
       setLoading(false)
     }
   }
   ```

3. Add skeleton card component before the accounts grid:
   ```tsx
   const SkeletonCard = () => (
     <div className="bg-slate-800/50 rounded-xl p-6 shadow-lg border border-slate-700 animate-pulse">
       <div className="flex items-center justify-between mb-4">
         <div className="flex items-center gap-3">
           <div className="w-10 h-10 bg-slate-700 rounded-lg" />
           <div>
             <div className="h-4 w-24 bg-slate-700 rounded mb-2" />
             <div className="h-3 w-12 bg-slate-700 rounded" />
           </div>
         </div>
         <div className="w-8 h-8 bg-slate-700 rounded" />
       </div>
       <div className="space-y-2">
         <div className="h-3 w-20 bg-slate-700 rounded" />
         <div className="h-3 w-32 bg-slate-700 rounded" />
       </div>
     </div>
   )
   ```

4. Render skeletons during loading:
   ```tsx
   {loading ? (
     <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
       <SkeletonCard />
       <SkeletonCard />
       <SkeletonCard />
     </div>
   ) : accounts.length === 0 ? (
     // existing empty state
   ) : (
     // existing accounts grid
   )}
   ```
  </action>
  <verify>
Frontend compiles. On page load, skeleton cards appear before accounts load. Skeletons animate with pulse effect.
  </verify>
  <done>
Skeleton loading cards display during initial data fetch. Smooth transition to real content.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add toast notifications for errors</name>
  <files>web/src/pages/CloudAccountsPage.tsx, web/src/main.tsx</files>
  <action>
Add toast notifications using react-hot-toast (lightweight, no config needed):

1. Install react-hot-toast (add to package.json dependencies):
   The executor should run: `npm install react-hot-toast` in web/

2. In `main.tsx`, add Toaster component:
   ```tsx
   import { Toaster } from 'react-hot-toast'
   
   // In the render, add Toaster at root level:
   ReactDOM.createRoot(document.getElementById('root')!).render(
     <React.StrictMode>
       <Toaster 
         position="top-right"
         toastOptions={{
           style: {
             background: '#1e293b',
             color: '#fff',
             border: '1px solid #334155',
           },
           error: {
             iconTheme: {
               primary: '#ef4444',
               secondary: '#fff',
             },
           },
         }}
       />
       <App />
     </React.StrictMode>,
   )
   ```

3. In `CloudAccountsPage.tsx`, use toast for errors:
   ```typescript
   import toast from 'react-hot-toast'
   
   // In loadAccounts catch:
   } catch (err) {
     console.error('Failed to load accounts:', err)
     toast.error('Failed to load cloud accounts')
   }
   
   // In handleDelete catch:
   } catch (err) {
     toast.error('Failed to delete cloud account')
   }
   
   // In handleSubmit catch:
   } catch (err) {
     toast.error('Failed to create cloud account')
   }
   
   // In handleSubmit success:
   toast.success('Cloud account connected successfully')
   ```

4. Remove the inline error state display since toasts now handle errors.
  </action>
  <verify>
`npm install react-hot-toast` runs successfully. Frontend compiles. Errors show as toast notifications in top-right. Success message appears on account creation.
  </verify>
  <done>
Toast notifications appear for errors and success. Toasts styled to match dark theme. Error state removed from inline display.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` in web/ compiles without errors
2. Cloud account cards show connection status chips (connected/syncing/failed)
3. Failed accounts show truncated error message
4. Skeleton cards appear during initial page load
5. Toast notifications appear on errors and success
6. Toasts are styled with dark theme
</verification>

<success_criteria>
- Connection status chip shows with appropriate color (green/blue/red/gray)
- Syncing status has pulse animation
- Failed status shows error icon and truncated error message
- Skeleton loading cards appear during initial fetch
- Toast notifications appear for all errors
- Success toast appears after creating account
</success_criteria>

<output>
After completion, create `.planning/phases/01-multi-cloud-discovery/01-04-SUMMARY.md`
</output>
