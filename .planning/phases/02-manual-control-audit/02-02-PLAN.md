---
phase: 02-manual-control-audit
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/components/ConfirmDialog.tsx
  - web/package.json
autonomous: true

must_haves:
  truths:
    - "ConfirmDialog component renders a modal when isOpen is true"
    - "ConfirmDialog shows title, message, and confirm/cancel buttons"
    - "ConfirmDialog calls onConfirm when confirm button clicked"
    - "ConfirmDialog calls onClose when cancel button clicked or ESC pressed"
  artifacts:
    - path: "web/src/components/ConfirmDialog.tsx"
      provides: "Reusable confirmation dialog component"
      exports: ["ConfirmDialog"]
      min_lines: 40
    - path: "web/package.json"
      provides: "@headlessui/react dependency"
      contains: "@headlessui/react"
  key_links:
    - from: "web/src/components/ConfirmDialog.tsx"
      to: "@headlessui/react"
      via: "Dialog, DialogPanel, DialogTitle imports"
      pattern: "import.*Dialog.*from '@headlessui/react'"
---

<objective>
Create reusable ConfirmDialog component using Headless UI

Purpose: All destructive actions (sleep/wake bulk operations) will use this dialog for confirmation
Output: ConfirmDialog.tsx component that can be imported and used throughout the app
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-manual-control-audit/02-RESEARCH.md

@web/src/main.tsx
@web/src/pages/InstancesPage.tsx
@web/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @headlessui/react</name>
  <files>web/package.json</files>
  <action>
Run in the web directory:
```bash
npm install @headlessui/react
```

This adds the Headless UI library which provides accessible, unstyled UI components including Dialog.
  </action>
  <verify>`cd web && npm ls @headlessui/react` shows the package is installed</verify>
  <done>@headlessui/react is in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create ConfirmDialog component</name>
  <files>web/src/components/ConfirmDialog.tsx</files>
  <action>
Create web/src/components/ConfirmDialog.tsx:

```typescript
import { Dialog, DialogPanel, DialogTitle, DialogBackdrop } from '@headlessui/react'

interface ConfirmDialogProps {
  isOpen: boolean
  onClose: () => void
  onConfirm: () => void
  title: string
  message: string
  confirmText: string
  confirmVariant: 'danger' | 'warning' | 'success'
  loading?: boolean
}

const variantClasses = {
  danger: 'bg-red-600 hover:bg-red-500 shadow-red-500/20',
  warning: 'bg-yellow-600 hover:bg-yellow-500 shadow-yellow-500/20',
  success: 'bg-green-600 hover:bg-green-500 shadow-green-500/20',
}

export function ConfirmDialog({
  isOpen,
  onClose,
  onConfirm,
  title,
  message,
  confirmText,
  confirmVariant,
  loading = false,
}: ConfirmDialogProps) {
  return (
    <Dialog open={isOpen} onClose={onClose} className="relative z-50">
      <DialogBackdrop
        transition
        className="fixed inset-0 bg-black/50 backdrop-blur-sm duration-200 ease-out data-[closed]:opacity-0"
      />
      <div className="fixed inset-0 flex items-center justify-center p-4">
        <DialogPanel
          transition
          className="max-w-md w-full bg-slate-800 p-6 rounded-xl border border-slate-700 shadow-2xl duration-200 ease-out data-[closed]:scale-95 data-[closed]:opacity-0"
        >
          <DialogTitle className="text-lg font-semibold text-white">
            {title}
          </DialogTitle>
          <p className="mt-3 text-slate-300">{message}</p>
          <div className="mt-6 flex justify-end gap-3">
            <button
              type="button"
              onClick={onClose}
              disabled={loading}
              className="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors disabled:opacity-50"
            >
              Cancel
            </button>
            <button
              type="button"
              onClick={onConfirm}
              disabled={loading}
              className={`px-4 py-2 text-white rounded-lg transition-all shadow-lg ${variantClasses[confirmVariant]} disabled:opacity-50`}
            >
              {loading ? 'Processing...' : confirmText}
            </button>
          </div>
        </DialogPanel>
      </div>
    </Dialog>
  )
}

export default ConfirmDialog
```

Note: Using Headless UI 2.x API with data-[closed] attributes for transitions. The dialog:
- Has backdrop blur effect matching dark theme
- Uses slate colors consistent with existing UI
- Supports loading state to disable buttons during async operations
- Has three variants: danger (red), warning (yellow), success (green)
  </action>
  <verify>`cd web && npm run build` compiles without errors</verify>
  <done>ConfirmDialog component exists with proper props interface, uses Headless UI Dialog</done>
</task>

</tasks>

<verification>
1. Package installed: `cd web && npm ls @headlessui/react` shows version
2. Component compiles: `cd web && npm run build` succeeds
3. Component exports: `grep "export.*ConfirmDialog" web/src/components/ConfirmDialog.tsx` returns match
</verification>

<success_criteria>
- @headlessui/react is installed in web/package.json
- ConfirmDialog.tsx exists in web/src/components/
- Component accepts isOpen, onClose, onConfirm, title, message, confirmText, confirmVariant, loading props
- Component uses Headless UI Dialog for accessibility (focus trap, ESC to close, backdrop click)
- Frontend build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/02-manual-control-audit/02-02-SUMMARY.md`
</output>
