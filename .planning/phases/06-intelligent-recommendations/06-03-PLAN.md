---
phase: 06-intelligent-recommendations
plan: 03
type: execute
wave: 2
depends_on: ["06-01", "06-02"]
files_modified:
  - web/src/pages/Dashboard.tsx
  - web/src/pages/RecommendationsPage.tsx
autonomous: true

must_haves:
  truths:
    - "Recommendations display as cards on the main dashboard"
    - "Recommendations are available in a dedicated recommendations tab"
    - "User can review a recommendation and confirm to create a schedule"
    - "Manual Generate Recommendations button visible on dashboard"
    - "Empty state shows call to action when no recommendations"
  artifacts:
    - path: "web/src/pages/Dashboard.tsx"
      provides: "Dashboard with recommendations section and generate button"
      contains: "generateRecommendations"
    - path: "web/src/pages/RecommendationsPage.tsx"
      provides: "Dedicated recommendations page with full functionality"
      contains: "RecommendationCard"
  key_links:
    - from: "web/src/pages/Dashboard.tsx"
      to: "web/src/components/RecommendationCard.tsx"
      via: "imports and renders"
      pattern: "import.*RecommendationCard"
    - from: "web/src/pages/RecommendationsPage.tsx"
      to: "web/src/components/RecommendationModal.tsx"
      via: "imports and renders"
      pattern: "import.*RecommendationModal"
    - from: "web/src/pages/RecommendationsPage.tsx"
      to: "web/src/lib/api.ts"
      via: "API calls for dismiss/confirm"
      pattern: "api\\.dismissRecommendation|api\\.confirmRecommendation"
---

<objective>
Integrate recommendation components into Dashboard and RecommendationsPage.

Purpose: Complete the user-facing recommendation experience by adding the recommendations section to the dashboard with generate button, and refactoring the RecommendationsPage to use the new components with full dismiss/confirm workflow.

Output: Functional recommendation display and interaction on both Dashboard and dedicated page.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-intelligent-recommendations/06-CONTEXT.md
@.planning/phases/06-intelligent-recommendations/06-RESEARCH.md

# Summary from prior plans
@.planning/phases/06-intelligent-recommendations/06-01-SUMMARY.md
@.planning/phases/06-intelligent-recommendations/06-02-SUMMARY.md

# Files to modify
@web/src/pages/Dashboard.tsx
@web/src/pages/RecommendationsPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Dashboard with recommendations section</name>
  <files>web/src/pages/Dashboard.tsx</files>
  <action>
Update web/src/pages/Dashboard.tsx to add recommendations section with generate button:

1. Update imports:
   - Import RecommendationCard from '../components/RecommendationCard'
   - Import RecommendationModal from '../components/RecommendationModal'
   - Import type RecommendationEnriched from '../lib/api'
   - Import RefreshCw icon from lucide-react

2. Update state:
   - Change recommendations type from Recommendation[] to RecommendationEnriched[]
   - Add selectedRecommendation: RecommendationEnriched | null state
   - Add modalOpen: boolean state
   - Add generating: boolean state for generate button loading
   - Add confirmLoading: boolean state for confirm action

3. Update useEffect data fetch:
   - Change api.getRecommendations() to api.getRecommendations('pending') to only fetch pending
   - Handle null/empty response

4. Add generate recommendations handler:
```typescript
const handleGenerate = async () => {
  setGenerating(true);
  try {
    const result = await api.generateRecommendations();
    toast.success(result.message);
    // Refresh recommendations list
    const updated = await api.getRecommendations('pending');
    setRecommendations(updated || []);
  } catch (err) {
    toast.error('Failed to generate recommendations');
  } finally {
    setGenerating(false);
  }
};
```

5. Add dismiss handler:
```typescript
const handleDismiss = async (id: string) => {
  try {
    await api.dismissRecommendation(id);
    setRecommendations(prev => prev.filter(r => r.id !== id));
    toast.success('Recommendation dismissed');
  } catch (err) {
    toast.error('Failed to dismiss recommendation');
  }
};
```

6. Add confirm handler:
```typescript
const handleConfirm = async (id: string) => {
  setConfirmLoading(true);
  try {
    await api.confirmRecommendation(id);
    setRecommendations(prev => prev.filter(r => r.id !== id));
    setModalOpen(false);
    setSelectedRecommendation(null);
    toast.success('Schedule created from recommendation!');
  } catch (err) {
    toast.error('Failed to create schedule');
  } finally {
    setConfirmLoading(false);
  }
};
```

7. Replace existing recommendations section (around line 305-335) with new UI:
   - Section header: "AI Recommendations" with generate button
   - Generate button: RefreshCw icon, "Generate" text, disabled while generating, spinner when loading
   - List of RecommendationCard components (show first 3)
   - Empty state per CONTEXT.md:
     - If no pending recommendations and dismissed count > 0: "No pending recommendations. {dismissedCount} dismissed."
     - If no data: "Need 24+ hours of activity data to generate recommendations."
     - Show "Generate Recommendations" button in empty state
   - "View all recommendations →" link to /recommendations

8. Add RecommendationModal at end of component:
```tsx
<RecommendationModal
  isOpen={modalOpen}
  onClose={() => { setModalOpen(false); setSelectedRecommendation(null); }}
  recommendation={selectedRecommendation}
  onConfirm={handleConfirm}
  loading={confirmLoading}
/>
```

9. Import toast from react-hot-toast for notifications.
  </action>
  <verify>
Run: `cd web && npm run build` - should compile without errors
Run: `cd web && npm run dev` - dashboard should render with recommendations section
  </verify>
  <done>
Dashboard shows recommendations section with generate button, collapsible cards, and empty state. Modal opens on "View Details" click.
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor RecommendationsPage with new components</name>
  <files>web/src/pages/RecommendationsPage.tsx</files>
  <action>
Refactor web/src/pages/RecommendationsPage.tsx to use new components:

1. Update imports:
   - Import RecommendationCard from '../components/RecommendationCard'
   - Import RecommendationModal from '../components/RecommendationModal'
   - Import type RecommendationEnriched from '../lib/api'
   - Import RefreshCw icon from lucide-react
   - Import toast from 'react-hot-toast'

2. Update state:
   - Change recommendations type to RecommendationEnriched[]
   - Add dismissedCount: number state
   - Add selectedRecommendation: RecommendationEnriched | null state
   - Add modalOpen: boolean state
   - Add generating: boolean state
   - Add confirmLoading: boolean state
   - Remove error state (use toast instead)

3. Update useEffect:
   - Fetch pending recommendations: api.getRecommendations('pending')
   - Fetch dismissed count: api.getRecommendations('dismissed').then(d => d?.length || 0)
   - Set both states

4. Add handlers (same as Dashboard):
   - handleGenerate: Generate recommendations with toast feedback
   - handleDismiss: Remove from list with toast
   - handleConfirm: Create schedule, remove from list, close modal with toast
   - handleOpenModal: Set selected and open modal

5. Update header section:
   - Title: "Recommendations"
   - Subtitle: "{recommendations.length} pending · {dismissedCount} dismissed"
   - "Generate Recommendations" button with RefreshCw icon, loading state

6. Replace recommendation list rendering:
   - Use RecommendationCard for each recommendation
   - Pass onOpenModal={handleOpenModal}
   - Pass onDismiss={handleDismiss}
   - Full list (not limited to 3 like dashboard)

7. Update empty state per CONTEXT.md:
   - Icon: TrendingDown in slate circle
   - If dismissedCount > 0: "No pending recommendations. {dismissedCount} dismissed recommendations."
   - If no data at all: "Need 24+ hours of activity data"
   - Prominent "Generate Recommendations" button
   - Per CONTEXT.md: "Minimum data requirement clearly stated"

8. Add RecommendationModal at end:
```tsx
<RecommendationModal
  isOpen={modalOpen}
  onClose={() => { setModalOpen(false); setSelectedRecommendation(null); }}
  recommendation={selectedRecommendation}
  onConfirm={handleConfirm}
  loading={confirmLoading}
/>
```

9. Remove old Apply/Ignore buttons and inline card rendering - all replaced by RecommendationCard component.
  </action>
  <verify>
Run: `cd web && npm run build` - should compile without errors
Run: `cd web && npm run dev` - navigate to /recommendations, should render new UI
  </verify>
  <done>
RecommendationsPage refactored with new components, generate button, dismiss/confirm flow, and proper empty states.
  </done>
</task>

</tasks>

<verification>
After completing both tasks:
1. `cd web && npm run build` compiles without errors
2. Dashboard shows recommendations section with:
   - Generate button that triggers API call
   - Collapsible recommendation cards (max 3)
   - "View all" link to /recommendations
   - Empty state with call to action
3. RecommendationsPage shows:
   - Full list of recommendations with generate button
   - Dismiss via "Mark as Not Now" removes from list
   - "View Details" opens modal
   - Confirm in modal creates schedule
   - Empty state with dismissed count message
</verification>

<success_criteria>
- Dashboard displays recommendations section with generate button and empty state
- RecommendationsPage shows all pending recommendations sorted by savings
- User can dismiss recommendations ("Mark as Not Now")
- User can confirm recommendations (creates schedule)
- Toast notifications for all actions
- Proper empty states per CONTEXT.md requirements
</success_criteria>

<output>
After completion, create `.planning/phases/06-intelligent-recommendations/06-03-SUMMARY.md`
</output>
