# Milestone v1.1: Enhanced Insights & Savings

**Status:** ✅ SHIPPED 2026-02-24
**Phases:** 7-9
**Total Plans:** 9

## Overview

Extended the v1.0 foundation with cost savings tracking, usage analytics, and historical visualization. After building and validating the savings feature, the decision was made to remove it — making this a complete feature lifecycle: build → evaluate → remove.

## Phases

### Phase 7: Core Savings Calculation & API
**Goal**: System calculates and exposes cost savings data from stop/start events
**Depends on**: Phase 6 (v1.0 foundation)
**Requirements**: SAV-01, SAV-02, AUD-01, AUD-02
**Success Criteria** (what must be TRUE):
  1. User can see total estimated savings in cents for any time range via API
  2. User can retrieve daily savings breakdown with stopped minutes and savings per day
  3. User can query savings attributed to specific instances
  4. All savings calculations are logged with instance ID, date, stopped minutes, and rate
  5. System captures hourly rate at stop event time (handles instance resizing)
**Plans**: 3 plans

Plans:
- [x] 07-01-PLAN.md — Database migration, SavingsStore, SavingsCalculator
- [x] 07-02-PLAN.md — EventStoreWithSavings decorator + main.go integration
- [x] 07-03-PLAN.md — SavingsHandler API endpoints

**Details:**
- Migration 006 with time-range indexes and materialized view
- SavingsStore with upsert/query methods following existing patterns
- SavingsCalculator with 7-day cap based on AWS auto-restart limits
- Integer cents pattern for all money calculations (no float64)
- EventStoreWithSavings decorator for automatic savings calculation on stop/start events

### Phase 8: Dashboard & Visualization
**Goal**: Users can visualize savings trends, per-instance attribution, and cost projections
**Depends on**: Phase 7
**Requirements**: SAV-03, SAV-04, SAV-05
**Success Criteria** (what must be TRUE):
  1. User can view time-series chart of savings over configurable ranges (7d, 30d, 90d, custom)
  2. User can see per-instance savings table showing which instances contributed most
  3. User can compare actual costs vs projected "always-on" costs with clear disclaimers
  4. Dashboard displays summary cards with total savings and period-over-period trends
**Plans**: 5 plans (includes 08-05 bugfix plan)

Plans:
- [x] 08-01-PLAN.md — API types, formatters, DateRangeSelector component
- [x] 08-02-PLAN.md — SavingsSummaryCards, SavingsChart, InstanceSavingsTable components
- [x] 08-03-PLAN.md — CostProjection component with SAV-05 disclaimer
- [x] 08-04-PLAN.md — SavingsPage integration, routing, navigation, visual verification
- [x] 08-05-SUMMARY.md — Instance Details & Metrics bugfix

**Details:**
- Savings API types and currency formatter using Intl.NumberFormat
- DateRangeSelector with 7d/30d/90d tab navigation
- SavingsSummaryCards (2 cards), SavingsChart with green theme
- InstanceSavingsTable with ranked rows for attribution
- CostProjection component with yellow disclaimer styling
- SavingsPage assembled all components with parallel API fetching

### Phase 9: Complete Savings Removal & Cache Validation
**Goal**: Remove all savings-related code from frontend and backend, rebuild Docker containers with fresh artifacts
**Depends on**: Phase 8, Quick Task #002
**Requirements**: None (cleanup phase)
**Success Criteria** (what must be TRUE):
  1. No savings-related code in frontend (web/src/)
  2. No savings endpoints registered in backend
  3. No savings handlers, stores, or calculators in backend
  4. Docker containers rebuilt with fresh artifacts
  5. Navigation shows only: Dashboard, Accounts, Instances, Schedules, Recommendations, Audit Log
**Plans**: 1 plan

Plans:
- [x] 09-01-PLAN.md — Complete savings removal and Docker rebuild

**Details:**
- Removed savings API methods and TypeScript interfaces from frontend
- Removed savings routes, handlers, stores, and calculators from backend
- Deleted entire internal/savings/ package
- Updated CostOverTimeChart to use estimated cost calculation
- Rebuilt Docker containers with --no-cache flag

---

## Milestone Summary

**Decimal Phases:** None

**Key Decisions:**

| Decision | Rationale | Outcome |
|----------|-----------|---------|
| Use integer cents throughout | No float64 for money to avoid precision issues | ✓ Good |
| 7-day maximum duration | Based on AWS auto-restart limits | ✓ Good |
| Materialized view for aggregation | O(1) dashboard queries | ✓ Good (removed with feature) |
| EventStoreWithSavings decorator | Automatic savings on events | ✓ Good (removed with feature) |
| Remove savings feature entirely | User decision to pivot direction | ✓ Executed cleanly |

**Issues Resolved:**
- Instance Details page 404 error (UUID vs provider ID lookup)
- Savings page 500 error (type assertion fix)
- Missing metrics_hourly table (added to schema)

**Issues Deferred:**
- Orphaned formatters.ts file (~50 lines)
- Orphaned Saving struct and SavingsCents field (~20 lines)
- Migration files kept for history

**Technical Debt Incurred:**
- Accepted tech debt from savings removal (minimal, tracked in MILESTONE-AUDIT.md)

---

*For current project status, see .planning/ROADMAP.md*
